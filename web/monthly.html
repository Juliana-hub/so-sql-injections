<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.min.js"></script>
</head>
<body>

<div style="width:800px; height:1200px">
	<canvas id="injections-per-month-chart"></canvas>
	<canvas id="injections-percent-per-month-chart"></canvas>
</div>

<script>
var monthlyInjections = [{"month":200808,"has_sql_count":4,"has_sql_injection_count":1},{"month":200809,"has_sql_count":20,"has_sql_injection_count":5},{"month":200810,"has_sql_count":25,"has_sql_injection_count":11},{"month":200811,"has_sql_count":29,"has_sql_injection_count":11},{"month":200812,"has_sql_count":23,"has_sql_injection_count":10},{"month":200901,"has_sql_count":44,"has_sql_injection_count":16},{"month":200902,"has_sql_count":63,"has_sql_injection_count":29},{"month":200903,"has_sql_count":65,"has_sql_injection_count":25},{"month":200904,"has_sql_count":69,"has_sql_injection_count":25},{"month":200905,"has_sql_count":74,"has_sql_injection_count":38},{"month":200906,"has_sql_count":112,"has_sql_injection_count":58},{"month":200907,"has_sql_count":164,"has_sql_injection_count":73},{"month":200908,"has_sql_count":171,"has_sql_injection_count":61},{"month":200909,"has_sql_count":150,"has_sql_injection_count":67},{"month":200910,"has_sql_count":185,"has_sql_injection_count":79},{"month":200911,"has_sql_count":181,"has_sql_injection_count":81},{"month":200912,"has_sql_count":202,"has_sql_injection_count":97},{"month":201001,"has_sql_count":258,"has_sql_injection_count":108},{"month":201002,"has_sql_count":265,"has_sql_injection_count":127},{"month":201003,"has_sql_count":297,"has_sql_injection_count":134},{"month":201004,"has_sql_count":309,"has_sql_injection_count":137},{"month":201005,"has_sql_count":300,"has_sql_injection_count":140},{"month":201006,"has_sql_count":284,"has_sql_injection_count":116},{"month":201007,"has_sql_count":279,"has_sql_injection_count":121},{"month":201008,"has_sql_count":380,"has_sql_injection_count":179},{"month":201009,"has_sql_count":349,"has_sql_injection_count":173},{"month":201010,"has_sql_count":391,"has_sql_injection_count":176},{"month":201011,"has_sql_count":420,"has_sql_injection_count":188},{"month":201012,"has_sql_count":369,"has_sql_injection_count":190},{"month":201101,"has_sql_count":542,"has_sql_injection_count":242},{"month":201102,"has_sql_count":646,"has_sql_injection_count":327},{"month":201103,"has_sql_count":796,"has_sql_injection_count":372},{"month":201104,"has_sql_count":800,"has_sql_injection_count":376},{"month":201105,"has_sql_count":880,"has_sql_injection_count":411},{"month":201106,"has_sql_count":891,"has_sql_injection_count":435},{"month":201107,"has_sql_count":1006,"has_sql_injection_count":497},{"month":201108,"has_sql_count":1040,"has_sql_injection_count":484},{"month":201109,"has_sql_count":912,"has_sql_injection_count":447},{"month":201110,"has_sql_count":997,"has_sql_injection_count":486},{"month":201111,"has_sql_count":1114,"has_sql_injection_count":524},{"month":201112,"has_sql_count":1006,"has_sql_injection_count":461},{"month":201201,"has_sql_count":1229,"has_sql_injection_count":626},{"month":201202,"has_sql_count":1312,"has_sql_injection_count":655},{"month":201203,"has_sql_count":1396,"has_sql_injection_count":666},{"month":201204,"has_sql_count":1566,"has_sql_injection_count":762},{"month":201205,"has_sql_count":1584,"has_sql_injection_count":734},{"month":201206,"has_sql_count":1575,"has_sql_injection_count":738},{"month":201207,"has_sql_count":1714,"has_sql_injection_count":805},{"month":201208,"has_sql_count":1707,"has_sql_injection_count":823},{"month":201209,"has_sql_count":1455,"has_sql_injection_count":713},{"month":201210,"has_sql_count":1845,"has_sql_injection_count":875},{"month":201211,"has_sql_count":1730,"has_sql_injection_count":821},{"month":201212,"has_sql_count":1551,"has_sql_injection_count":740},{"month":201301,"has_sql_count":1428,"has_sql_injection_count":642},{"month":201302,"has_sql_count":1566,"has_sql_injection_count":724},{"month":201303,"has_sql_count":1906,"has_sql_injection_count":939},{"month":201304,"has_sql_count":1830,"has_sql_injection_count":873},{"month":201305,"has_sql_count":567,"has_sql_injection_count":259}];

function createTrendData(data, monthCount) {
	var output = [];
	var c = 0;
	var sum = 0;
	for (var i = 0; i < data.length; i++) {
		sum += data[i];
		c++;
		if (c == monthCount) {
			output.push(sum / monthCount);
			sum = 0;
			c = 0;
		}
	}
	return output;
}

var labels = [];
var data = [];
var dataPercent = [];
var injectBackgroundColors = [];
var injectPercentBackgroundColors = [];
var maxCount = 0;
var maxPercent = 0;
for (var i = 0; i < monthlyInjections.length; i++) {
	var r = monthlyInjections[i];
	if (r.has_sql_injection_count > maxCount) maxCount = r.has_sql_injection_count;
	if ((r.has_sql_injection_count / r.has_sql_count) * 100 > maxPercent) maxPercent = (r.has_sql_injection_count / r.has_sql_count) * 100;
}

for (var i = 0; i < monthlyInjections.length; i++) {
	var r = monthlyInjections[i];
	var m = r.month.toString();
	var percent = (r.has_sql_injection_count / r.has_sql_count) * 100;
	labels.push(m.substring(4) + '/' + m.substring(0, 4));
	data.push(r.has_sql_injection_count);
	dataPercent.push(percent);

	var p = r.has_sql_injection_count / maxCount;
	var colorR = Math.round(255 * p);
	var colorG = Math.round(255 * (1 - p));
	injectBackgroundColors.push('rgba(' + colorR +', ' + colorG + ', 80, 0.7)');

	p = percent / maxPercent;
	colorR = Math.round(255 * p);
	colorG = Math.round(255 * (1 - p));
	injectPercentBackgroundColors.push('rgba(' + colorR +', ' + colorG + ', 80, 0.7)');
}

var ctx = document.getElementById("injections-per-month-chart");

var myChart = new Chart(ctx, {
	type: 'bar',
	data: {
		labels: labels,
		datasets: [{
			label: "Questions with SQL injections",
			backgroundColor: injectBackgroundColors,
			data: data,
		}]
	},
	options: {
		scales: {
			yAxes: [{
				ticks: {
					beginAtZero:true
				}
			}]
		}
	}
});

var ctx2 = document.getElementById("injections-percent-per-month-chart");

var myChart2 = new Chart(ctx2, {
	type: 'bar',
	data: {
		labels: labels,
		datasets: [{
			label: "SQL injections as a percentage of SQL-related questions",
			backgroundColor: injectPercentBackgroundColors,
			data: dataPercent,
		}]
	},
	options: {
		scales: {
			yAxes: [{
				ticks: {
					beginAtZero:true
				}
			}]
		}
	}
});
</script>


</body>
</html>